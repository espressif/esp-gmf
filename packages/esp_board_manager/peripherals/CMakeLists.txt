# Function to get peripheral sources
function(get_peripheral_sources sources includes)
    set(srcs "")
    set(incs "")

    if(CONFIG_ESP_BOARD_PERIPH_GPIO_SUPPORT)
        message(STATUS "GPIO_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_gpio/periph_gpio.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_gpio")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_I2C_SUPPORT)
        message(STATUS "I2C_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_i2c/periph_i2c.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_i2c")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_I2S_SUPPORT)
        message(STATUS "I2S_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_i2s/periph_i2s.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_i2s")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_SPI_SUPPORT)
        message(STATUS "LCD_SPI_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_spi/periph_spi.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_spi")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_LEDC_SUPPORT)
        message(STATUS "LEDC_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_ledc/periph_ledc.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_ledc")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_UART_SUPPORT)
        message(STATUS "UART_SUPPOR")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_uart/periph_uart.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_uart")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_ADC_SUPPORT)
        message(STATUS "ADC_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_adc/periph_adc.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_adc")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_RMT_SUPPORT)
        message(STATUS "RMT_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_rmt/periph_rmt.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_rmt")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_PCNT_SUPPORT)
        message(STATUS "PCNT_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_pcnt/periph_pcnt.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_pcnt")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_DAC_SUPPORT)
        message(STATUS "DAC_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_dac/periph_dac.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_dac")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_SDM_SUPPORT)
        message(STATUS "SDM_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_sdm/periph_sdm.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_sdm")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_MCPWM_SUPPORT)
        message(STATUS "MCPWM_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_mcpwm/periph_mcpwm.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_mcpwm")
    endif()

    if(CONFIG_ESP_BOARD_PERIPH_ANACMPR_SUPPORT)
        message(STATUS "ANACMPR_SUPPORT")
        list(APPEND srcs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_anacmpr/periph_anacmpr.c")
        list(APPEND incs "${CMAKE_CURRENT_LIST_DIR}/peripherals/periph_anacmpr")
    endif()

    # Set output variables in parent scope
    set(${sources} ${srcs} PARENT_SCOPE)
    set(${includes} ${incs} PARENT_SCOPE)
    # message(STATUS "sources: ${srcs}")
    # message(STATUS "includes: ${incs}")
endfunction()
