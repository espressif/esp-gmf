board: esp32_s3_devkitc
chip: esp32s3
version: 1.0.0
# Peripherals Configuration
peripherals:
  - name: uart_1
    type: uart
    role: master
    config:
      uart_num: UART_NUM_1
      rx_buffer_size: 1024
      tx_buffer_size: 1024
      use_queue: false
      intr_alloc_flags: 0

      uart_config:
        baud_rate: 115200
        data_bits : UART_DATA_8_BITS
        parity : UART_PARITY_DISABLE
        stop_bits : UART_STOP_BITS_1
        flow_ctrl : UART_HW_FLOWCTRL_DISABLE
        source_clk : UART_SCLK_DEFAULT

      tx_io_num: 18
      rx_io_num: 17
      rts_io_num: -1
      cts_io_num: -1

      uart_mode: UART_MODE_UART

  - name: adc_handle
    type: adc
    role: continuous
    config:
      unit_id: ADC_UNIT_1
      atten: ADC_ATTEN_DB_0
      bit_width: ADC_BITWIDTH_12

      max_store_buf_size: 1024
      conv_frame_size: 256
      flush_pool: 1
      sample_freq_hz: 20000
      format: ADC_DIGI_OUTPUT_FORMAT_TYPE2
      conv_mode: ADC_CONV_SINGLE_UNIT_1

      pattern_num: 1
      channel_id: [4]

  - name: adc_handle
    type: adc
    role: oneshot
    config:
      role: oneshot
      unit_id: ADC_UNIT_1
      atten: ADC_ATTEN_DB_0
      bit_width: ADC_BITWIDTH_12

      channel_id: 4
      clk_src: SOC_MOD_CLK_RC_FAST
      ulp_mode: ADC_ULP_MODE_DISABLE

  - name: rmt_tx
    type: rmt
    role: tx
    config:
      gpio_num: 48
      clk_src: RMT_CLK_SRC_DEFAULT
      resolution_hz: 10000000
      mem_block_symbols: 64
      trans_queue_depth: 4
      intr_priority: 1
      flags:
        invert_out: false
        with_dma: true  # RMT peripheral can connect to DMA channel in esp32s3
        io_loop_back: false
        io_od_mode: false
        allow_pd: false
        init_level: false

  - name: pcnt_unit
    type: pcnt
    config:
      unit_config:
        low_limit: -100
        high_limit: 100
        intr_priority: 0

        flags:
          accum_count: true

      filter_config:
        max_glitch_ns: 1000

      channel_count: 2
      channel_list:
        - channel: 0
          channel_config:
            edge_gpio_num: 37
            level_gpio_num: 38
            flags:
              invert_edge_input: false
              invert_level_input: false
              virt_edge_io_level: 0
              virt_level_io_level: 0
              io_loop_back: false
          pos_act: PCNT_CHANNEL_EDGE_ACTION_DECREASE
          neg_act: PCNT_CHANNEL_EDGE_ACTION_INCREASE
          high_act: PCNT_CHANNEL_LEVEL_ACTION_KEEP
          low_act: PCNT_CHANNEL_LEVEL_ACTION_INVERSE

        - channel: 1
          channel_config:
            edge_gpio_num: 38
            level_gpio_num: 37
            flags:
              invert_edge_input: false
              invert_level_input: false
              virt_edge_io_level: 0
              virt_level_io_level: 0
              io_loop_back: false
          pos_act: PCNT_CHANNEL_EDGE_ACTION_INCREASE
          neg_act: PCNT_CHANNEL_EDGE_ACTION_DECREASE
          high_act: PCNT_CHANNEL_LEVEL_ACTION_KEEP
          low_act: PCNT_CHANNEL_LEVEL_ACTION_INVERSE

      watch_point_count: 5
      watch_point_list: [-100, -50, 0, 50, 100]

  - name: gpio_power
    type: gpio
    config:
      pin: 48
      mode: GPIO_MODE_OUTPUT
      default_level: 1

  - name: spi_master
    type: spi
    role: master
    config:
      # spi_bus_config_t fields
      spi_bus_config:
        spi_port: SPI2_HOST
        mosi_io_num: 4
        miso_io_num: 5
        sclk_io_num: 2
        max_transfer_sz: 4000

  - name: mcpwm_handle
    type: mcpwm
    config:
      timer_config:
        group_id: 0
        clk_src: MCPWM_TIMER_CLK_SRC_DEFAULT
        resolution_hz: 1000000
        period_ticks: 20000
        count_mode: MCPWM_TIMER_COUNT_MODE_UP
        intr_priority: 1
        flags:
          update_period_on_empty: false
          update_period_on_sync: false
          allow_pd: false

      operator_config:
        group_id: 0
        intr_priority: 1
        flags:
          update_gen_action_on_tez: false
          update_gen_action_on_tep: false
          update_gen_action_on_sync: false
          update_dead_time_on_tez: false
          update_dead_time_on_tep: false
          update_dead_time_on_sync: false

      # comparator_config:
      #   intr_priority: 0
      #   flags:
      #     update_cmp_on_tez: true
      #     update_cmp_on_tep: false
      #     update_cmp_on_sync: false

      comparator_configs:
        - comparator: 0
          intr_priority: 0
          flags:
            update_cmp_on_tez: true
            update_cmp_on_tep: false
            update_cmp_on_sync: false

        - comparator: 1
          intr_priority: 0
          flags:
            update_cmp_on_tez: true
            update_cmp_on_tep: false
            update_cmp_on_sync: false

      generator_config:
        gpio_num: 45
        flags:
          invert_pwm: false
          io_loop_back: false
          io_od_mode: false
          pull_up: false
          pull_down: false
